---
- name: Wait for the license master
  include_tasks: wait_for_splunk_instance.yml
  vars:
    scheme: "{{ splunk.license_master_url | urlsplit('scheme') }}"
    splunk_instance_address: "{{ splunk.license_master_url | urlsplit('hostname') }}"
    port: "{{ splunk.license_master_url | urlsplit('port') }}"
  no_log: "{{ hide_password }}"

- name: Set node as license peer - FAST
  ini_file:
    dest: "{{ splunk.home }}/etc/system/local/server.conf"
    section: license
    option: manager_uri
    value: "https://lm1:8089"
    owner: "{{ splunk.user }}"
    group: "{{ splunk.group }}"
  become: yes
  become_user: "{{ splunk.user }}"
